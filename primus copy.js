!function(e,t,n,r){t[e]=n.call(t);for(var o=0;o<r.length;o++)r[o](t[e]);"undefined"!=typeof module&&module.exports?module.exports=t[e]:"function"==typeof define&&define.amd&&define((function(){return t[e]}))}("Primus",this||{},(function(){var e=function e(t,n,r){function o(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(i)return i(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[s]={exports:{}};t[s][0].call(f.exports,(function(e){return o(t[s][1][e]||e)}),f,f.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";t.exports=function(e,t){var n=/[, ]+/;function r(e,r){if(t[e]){if("string"==typeof t[e]&&(t[e]=t[e].split(n)),"function"==typeof t[e])return t[e].call(r);for(var o,i,s=0;s<t[e].length;s++)"function"===(o=typeof(i=t[e][s]))?i.call(r):"string"===o&&"function"==typeof r[i]&&r[i]()}}return t=t||{},"string"==typeof(e=e||[])&&(e=e.split(n)),function(){var t,n=this,o=0;if(null===n[e[0]])return!1;for(r("before",n);o<e.length;o++)n[t=e[o]]&&("function"==typeof n[t].destroy&&n[t].destroy(),n[t]=null);return n.emit&&n.emit("destroy"),r("after",n),!0}}},{}],2:[function(e,t,n){"use strict";t.exports=function(){for(var e,t=this,n=0,r=arguments.length,o=new Array(r);n<r;n++)o[n]=arguments[n];return"function"!=typeof o[o.length-1]?function(){for(var e=0,n=arguments.length,r=new Array(n);e<n;e++)r[e]=arguments[e];return t.emit.apply(t,o.concat(r))}:(e=o.pop(),function(){for(var n=0,r=arguments.length,i=new Array(r+1);n<r;n++)i[n+1]=arguments[n];return i[0]=function(e,n){if(e)return t.emit("error",e);i=void 0===n?i.slice(1):null===n?[]:n,t.emit.apply(t,o.concat(i))},e.apply(t,i),!0})}},{}],3:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,o="~";function i(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function c(e,t,n,r,i){if("function"!=typeof n)throw new TypeError("The listener must be a function");var c=new s(n,r||e,i),a=o?o+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],c]:e._events[a].push(c):(e._events[a]=c,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function u(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(o=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(o?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=o?o+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,s=new Array(i);r<i;r++)s[r]=n[r].fn;return s},u.prototype.listenerCount=function(e){var t=o?o+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,r,i,s){var c=o?o+e:e;if(!this._events[c])return!1;var a,u,f=this._events[c],l=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,i),!0;case 6:return f.fn.call(f.context,t,n,r,i,s),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var p,h=f.length;for(u=0;u<h;u++)switch(f[u].once&&this.removeListener(e,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,t);break;case 3:f[u].fn.call(f[u].context,t,n);break;case 4:f[u].fn.call(f[u].context,t,n,r);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[u].fn.apply(f[u].context,a)}}return!0},u.prototype.on=function(e,t,n){return c(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return c(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var i=o?o+e:e;if(!this._events[i])return this;if(!t)return a(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||a(this,i);else{for(var c=0,u=[],f=s.length;c<f;c++)(s[c].fn!==t||r&&!s[c].once||n&&s[c].context!==n)&&u.push(s[c]);u.length?this._events[i]=1===u.length?u[0]:u:a(this,i)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=o?o+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=o,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],4:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},{}],5:[function(e,t,n){"use strict";var r=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i"),o=36e5,i=24*o;t.exports=function(e){var t,n,s=typeof e;if("number"===s)return e;if("string"!==s||"0"===e||!e)return 0;if(+e)return+e;if(e.length>1e4||!(n=r.exec(e)))return 0;switch(t=parseFloat(n[1]),n[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 31536e6*t;case"weeks":case"week":case"wks":case"wk":case"w":return 6048e5*t;case"days":case"day":case"d":return t*i;case"hours":case"hour":case"hrs":case"hr":case"h":return t*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;default:return t}}},{}],6:[function(e,t,n){"use strict";t.exports=function(e){var t,n=0;function r(){return n||(n=1,t=e.apply(this,arguments),e=null),t}return r.displayName=e.displayName||e.name||r.displayName||r.name,r}},{}],7:[function(e,t,n){var r,o,i=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function a(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{o="function"==typeof clearTimeout?clearTimeout:c}catch(e){o=c}}();var u,f=[],l=!1,p=-1;function h(){l&&u&&(l=!1,u.length?f=u.concat(f):p=-1,f.length&&m())}function m(){if(!l){var e=a(h);l=!0;for(var t=f.length;t;){for(u=f,f=[];++p<t;)u&&u[p].run();p=-1,t=f.length}u=null,l=!1,function(e){if(o===clearTimeout)return clearTimeout(e);if((o===c||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(e);try{o(e)}catch(t){try{return o.call(null,e)}catch(t){return o.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function y(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new d(e,t)),1!==f.length||l||a(m)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],8:[function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty;function o(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}function i(e){try{return encodeURIComponent(e)}catch(e){return null}}n.stringify=function(e,t){t=t||"";var n,o,s=[];for(o in"string"!=typeof t&&(t="?"),e)if(r.call(e,o)){if((n=e[o])||null!=n&&!isNaN(n)||(n=""),o=i(o),n=i(n),null===o||null===n)continue;s.push(o+"="+n)}return s.length?t+s.join("&"):""},n.parse=function(e){for(var t,n=/([^=?#&]+)=?([^&]*)/g,r={};t=n.exec(e);){var i=o(t[1]),s=o(t[2]);null===i||null===s||i in r||(r[i]=s)}return r}},{}],9:[function(e,t,n){"use strict";var r=e("eventemitter3"),o=e("millisecond"),i=e("demolish"),s=e("tick-tock"),c=e("one-time");function a(e,t,n){return o(e in n?n[e]:e in t?t[e]:u[e])}function u(e){var t=this;if(!(t instanceof u))return new u(e);e=e||{},t.attempt=null,t._fn=null,t["reconnect timeout"]=a("reconnect timeout",t,e),t.retries=a("retries",t,e),t.factor=a("factor",t,e),t.max=a("max",t,e),t.min=a("min",t,e),t.timers=new s(t)}u.prototype=new r,u.prototype.constructor=u,u["reconnect timeout"]="30 seconds",u.max=1/0,u.min="500 ms",u.retries=10,u.factor=2,u.prototype.reconnect=function(){var e=this;return e.backoff((function(t,n){if(n.duration=+new Date-n.start,t)return e.emit("reconnect failed",t,n);e.emit("reconnected",n)}),e.attempt)},u.prototype.backoff=function(e,t){var n=this;return(t=t||n.attempt||{}).backoff?n:(t["reconnect timeout"]=a("reconnect timeout",n,t),t.retries=a("retries",n,t),t.factor=a("factor",n,t),t.max=a("max",n,t),t.min=a("min",n,t),t.start=+t.start||+new Date,t.duration=+t.duration||0,t.attempt=+t.attempt||0,t.attempt===t.retries?(e.call(n,new Error("Unable to recover"),t),n):(t.backoff=!0,t.attempt++,n.attempt=t,t.scheduled=1!==t.attempt?Math.min(Math.round((Math.random()+1)*t.min*Math.pow(t.factor,t.attempt-1)),t.max):t.min,n.timers.setTimeout("reconnect",(function(){t.duration=+new Date-t.start,t.backoff=!1,n.timers.clear("reconnect, timeout");var r=n._fn=c((function(r){if(n.reset(),r)return n.backoff(e,t);e.call(n,void 0,t)}));n.emit("reconnect",t,r),n.timers.setTimeout("timeout",(function(){var e=new Error("Failed to reconnect in a timely manner");t.duration=+new Date-t.start,n.emit("reconnect timeout",e,t),r(e)}),t["reconnect timeout"])}),t.scheduled),n.emit("reconnect scheduled",t),n))},u.prototype.reconnecting=function(){return!!this.attempt},u.prototype.reconnected=function(e){return this._fn&&this._fn(e),this},u.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},u.prototype.destroy=i("timers attempt _fn"),t.exports=u},{demolish:1,eventemitter3:10,millisecond:5,"one-time":6,"tick-tock":12}],10:[function(e,t,n){"use strict";var r="function"!=typeof Object.create&&"~";function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(e,t){var n=r?r+e:e,o=this._events&&this._events[n];if(t)return!!o;if(!o)return[];if(o.fn)return[o.fn];for(var i=0,s=o.length,c=new Array(s);i<s;i++)c[i]=o[i].fn;return c},i.prototype.emit=function(e,t,n,o,i,s){var c=r?r+e:e;if(!this._events||!this._events[c])return!1;var a,u,f=this._events[c],l=arguments.length;if("function"==typeof f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),l){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,o),!0;case 5:return f.fn.call(f.context,t,n,o,i),!0;case 6:return f.fn.call(f.context,t,n,o,i,s),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];f.fn.apply(f.context,a)}else{var p,h=f.length;for(u=0;u<h;u++)switch(f[u].once&&this.removeListener(e,f[u].fn,void 0,!0),l){case 1:f[u].fn.call(f[u].context);break;case 2:f[u].fn.call(f[u].context,t);break;case 3:f[u].fn.call(f[u].context,t,n);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];f[u].fn.apply(f[u].context,a)}}return!0},i.prototype.on=function(e,t,n){var i=new o(t,n||this),s=r?r+e:e;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.once=function(e,t,n){var i=new o(t,n||this,!0),s=r?r+e:e;return this._events||(this._events=r?{}:Object.create(null)),this._events[s]?this._events[s].fn?this._events[s]=[this._events[s],i]:this._events[s].push(i):this._events[s]=i,this},i.prototype.removeListener=function(e,t,n,o){var i=r?r+e:e;if(!this._events||!this._events[i])return this;var s=this._events[i],c=[];if(t)if(s.fn)(s.fn!==t||o&&!s.once||n&&s.context!==n)&&c.push(s);else for(var a=0,u=s.length;a<u;a++)(s[a].fn!==t||o&&!s[a].once||n&&s[a].context!==n)&&c.push(s[a]);return c.length?this._events[i]=1===c.length?c[0]:c:delete this._events[i],this},i.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[r?r+e:e]:this._events=r?{}:Object.create(null),this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.prefixed=r,void 0!==t&&(t.exports=i)},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},{}],12:[function(e,t,n){(function(n,r){(function(){"use strict";var o=Object.prototype.hasOwnProperty,i=e("millisecond");function s(e,t,n,r){this.start=+new Date,this.duration=n,this.clear=t,this.timer=e,this.fns=[r]}function c(e){clearTimeout(e)}function a(e){clearInterval(e)}function u(e){r(e)}function f(e){if(!(this instanceof f))return new f(e);this.timers={},this.context=e||this}s.prototype.remaining=function(){return this.duration-this.taken()},s.prototype.taken=function(){return+new Date-this.start},f.prototype.tock=function(e,t){var n=this;return function(){if(e in n.timers){var r=n.timers[e].fns.slice(),o=r.length,i=0;for(t?n.clear(e):n.start=+new Date;i<o;i++)r[i].call(n.context)}}},f.prototype.setTimeout=function(e,t,n){var r,o=this;return o.timers[e]?(o.timers[e].fns.push(t),o):(r=i(n),o.timers[e]=new s(setTimeout(o.tock(e,!0),i(n)),c,r,t),o)},f.prototype.setInterval=function(e,t,n){var r,o=this;return o.timers[e]?(o.timers[e].fns.push(t),o):(r=i(n),o.timers[e]=new s(setInterval(o.tock(e),i(n)),a,r,t),o)},f.prototype.setImmediate=function(e,t){var r=this;return"function"!=typeof n?r.setTimeout(e,t,0):r.timers[e]?(r.timers[e].fns.push(t),r):(r.timers[e]=new s(n(r.tock(e,!0)),u,0,t),r)},f.prototype.active=function(e){return e in this.timers},f.prototype.clear=function(){var e,t,n,r=arguments.length?arguments:[],i=this;if(1===r.length&&"string"==typeof r[0]&&(r=r[0].split(/[, ]+/)),!r.length)for(e in i.timers)o.call(i.timers,e)&&r.push(e);for(t=0,n=r.length;t<n;t++)(e=i.timers[r[t]])&&(e.clear(e.timer),e.fns=e.timer=e.clear=null,delete i.timers[r[t]]);return i},f.prototype.adjust=function(e,t){var n,r=this,o=i(t),s=r.timers[e];return s?(n=s.clear===a,s.clear(s.timer),s.start=+new Date,s.duration=o,s.timer=(n?setInterval:setTimeout)(r.tock(e,!n),o),r):r},f.prototype.end=f.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},f.Timer=s,t.exports=f}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{millisecond:5,timers:13}],13:[function(e,t,n){(function(t,r){(function(){var o=e("process/browser.js").nextTick,i=Function.prototype.apply,s=Array.prototype.slice,c={},a=0;function u(e,t){this._id=e,this._clearFn=t}n.setTimeout=function(){return new u(i.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new u(i.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(e){e.close()},u.prototype.unref=u.prototype.ref=function(){},u.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},n.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},n._unrefActive=n.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n.setImmediate="function"==typeof t?t:function(e){var t=a++,r=!(arguments.length<2)&&s.call(arguments,1);return c[t]=!0,o((function(){c[t]&&(r?e.apply(null,r):e.call(null),n.clearImmediate(t))})),t},n.clearImmediate="function"==typeof r?r:function(e){delete c[e]}}).call(this)}).call(this,e("timers").setImmediate,e("timers").clearImmediate)},{"process/browser.js":7,timers:13}],14:[function(e,t,n){(function(n){(function(){"use strict";var r=e("requires-port"),o=e("querystringify"),i=/^[A-Za-z][A-Za-z0-9+-.]*:[\\/]+/,s=/^([a-z][a-z0-9.+-]*:)?([\\/]{1,})?([\S\s]*)/i,c=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function a(e){return(e||"").toString().replace(c,"")}var u=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],f={hash:1,query:1};function l(e){var t,r=("undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{}).location||{},o={},s=typeof(e=e||r);if("blob:"===e.protocol)o=new h(unescape(e.pathname),{});else if("string"===s)for(t in o=new h(e,{}),f)delete o[t];else if("object"===s){for(t in e)t in f||(o[t]=e[t]);void 0===o.slashes&&(o.slashes=i.test(e.href))}return o}function p(e){e=a(e);var t=s.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!(t[2]&&t[2].length>=2),rest:t[2]&&1===t[2].length?"/"+t[3]:t[3]}}function h(e,t,n){if(e=a(e),!(this instanceof h))return new h(e,t,n);var i,s,c,f,m,d,y=u.slice(),v=typeof t,g=this,w=0;for("object"!==v&&"string"!==v&&(n=t,t=null),n&&"function"!=typeof n&&(n=o.parse),t=l(t),i=!(s=p(e||"")).protocol&&!s.slashes,g.slashes=s.slashes||i&&t.slashes,g.protocol=s.protocol||t.protocol||"",e=s.rest,s.slashes||(y[3]=[/(.*)/,"pathname"]);w<y.length;w++)"function"!=typeof(f=y[w])?(c=f[0],d=f[1],c!=c?g[d]=e:"string"==typeof c?~(m=e.indexOf(c))&&("number"==typeof f[2]?(g[d]=e.slice(0,m),e=e.slice(m+f[2])):(g[d]=e.slice(m),e=e.slice(0,m))):(m=c.exec(e))&&(g[d]=m[1],e=e.slice(0,m.index)),g[d]=g[d]||i&&f[3]&&t[d]||"",f[4]&&(g[d]=g[d].toLowerCase())):e=f(e);n&&(g.query=n(g.query)),i&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=function(e,t){if(""===e)return t;for(var n=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=n.length,o=n[r-1],i=!1,s=0;r--;)"."===n[r]?n.splice(r,1):".."===n[r]?(n.splice(r,1),s++):s&&(0===r&&(i=!0),n.splice(r,1),s--);return i&&n.unshift(""),"."!==o&&".."!==o||n.push(""),n.join("/")}(g.pathname,t.pathname)),"/"!==g.pathname.charAt(0)&&g.hostname&&(g.pathname="/"+g.pathname),r(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(f=g.auth.split(":"),g.username=f[0]||"",g.password=f[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}h.prototype={set:function(e,t,n){var i=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(n||o.parse)(t)),i[e]=t;break;case"port":i[e]=t,r(t,i.protocol)?t&&(i.host=i.hostname+":"+t):(i.host=i.hostname,i[e]="");break;case"hostname":i[e]=t,i.port&&(t+=":"+i.port),i.host=t;break;case"host":i[e]=t,/:\d+$/.test(t)?(t=t.split(":"),i.port=t.pop(),i.hostname=t.join(":")):(i.hostname=t,i.port="");break;case"protocol":i.protocol=t.toLowerCase(),i.slashes=!n;break;case"pathname":case"hash":if(t){var s="pathname"===e?"/":"#";i[e]=t.charAt(0)!==s?s+t:t}else i[e]=t;break;default:i[e]=t}for(var c=0;c<u.length;c++){var a=u[c];a[4]&&(i[a[1]]=i[a[1]].toLowerCase())}return i.origin=i.protocol&&i.host&&"file:"!==i.protocol?i.protocol+"//"+i.host:"null",i.href=i.toString(),i},toString:function(e){e&&"function"==typeof e||(e=o.stringify);var t,n=this,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var i=r+(n.slashes?"//":"");return n.username&&(i+=n.username,n.password&&(i+=":"+n.password),i+="@"),i+=n.host+n.pathname,(t="object"==typeof n.query?e(n.query):n.query)&&(i+="?"!==t.charAt(0)?"?"+t:t),n.hash&&(i+=n.hash),i}},h.extractProtocol=p,h.location=l,h.trimLeft=a,h.qs=o,t.exports=h}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{querystringify:8,"requires-port":11}],15:[function(e,t,n){"use strict";var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i={},s=0,c=0;function a(e){var t="";do{t=o[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function u(){var e=a(+new Date);return e!==r?(s=0,r=e):e+"."+a(s++)}for(;c<64;c++)i[o[c]]=c;u.encode=a,u.decode=function(e){var t=0;for(c=0;c<e.length;c++)t=64*t+i[e.charAt(c)];return t},t.exports=u},{}],16:[function(e,t,n){"use strict";var r,o=e("eventemitter3"),i=e("tick-tock"),s=e("recovery"),c=e("querystringify"),a=e("inherits"),u=e("demolish"),f=e("yeast"),l=/\u2028/g,p=/\u2029/g;function h(e,t){if(!(e instanceof m)){var n=new Error("Primus#"+t+"'s context should called with a Primus instance");if("function"!=typeof e.listeners||!e.listeners("error").length)throw n;e.emit("error",n)}}try{r=location.origin?location.origin:location.protocol+"//"+location.host}catch(e){r="http://127.0.0.1"}function m(e,t){if(!(this instanceof m))return new m(e,t);if(m.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof e?e=(t=e).url||t.uri||r:t=t||{},"ping"in t||"pong"in t)return this.critical(new Error("The `ping` and `pong` options have been removed"));var n=this;t.queueSize="queueSize"in t?t.queueSize:1/0,t.timeout="timeout"in t?t.timeout:1e4,t.reconnect="reconnect"in t?t.reconnect:{},t.pingTimeout="pingTimeout"in t?t.pingTimeout:45e3,t.strategy="strategy"in t?t.strategy:[],t.transport="transport"in t?t.transport:{},n.buffer=[],n.writable=!0,n.readable=!0,n.url=n.parse(e||r),n.readyState=m.CLOSED,n.options=t,n.timers=new i(this),n.socket=null,n.disconnect=!1,n.transport=t.transport,n.transformers={outgoing:[],incoming:[]},n.recovery=new s(t.reconnect),"string"==typeof t.strategy&&(t.strategy=t.strategy.split(/\s?,\s?/g)),!1===t.strategy?t.strategy=[]:t.strategy.length||(t.strategy.push("disconnect","online"),this.authorization||t.strategy.push("timeout")),t.strategy=t.strategy.join(",").toLowerCase(),"websockets"in t&&(n.AVOID_WEBSOCKETS=!t.websockets),"network"in t&&(n.NETWORK_EVENTS=t.network),t.manual||n.timers.setTimeout("open",(function(){n.timers.clear("open"),n.open()}),0),n.initialise(t)}m.requires=m.require=function(t){if("function"==typeof e)return e(t)};try{m.Stream=m.requires("stream")}catch(e){}m.Stream||(m.Stream=o),a(m,m.Stream),m.OPENING=1,m.CLOSED=2,m.OPEN=3,m.prototype.AVOID_WEBSOCKETS=!1,m.prototype.NETWORK_EVENTS=!1,m.prototype.online=!0;try{(m.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(m.prototype.online=!1))}catch(e){}if(m.prototype.ark={},m.prototype.emits=e("emits"),m.prototype.plugin=function(e){if(h(this,"plugin"),e)return this.ark[e];var t={};for(e in this.ark)t[e]=this.ark[e];return t},m.prototype.reserved=function(e){return/^(incoming|outgoing)::/.test(e)||e in this.reserved.events},m.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},m.prototype.initialise=function(e){var t=this;for(var n in t.recovery.on("reconnected",t.emits("reconnected")).on("reconnect failed",t.emits("reconnect failed",(function(e){t.emit("end"),e()}))).on("reconnect timeout",t.emits("reconnect timeout")).on("reconnect scheduled",t.emits("reconnect scheduled")).on("reconnect",t.emits("reconnect",(function(e){t.emit("outgoing::reconnect"),e()}))),t.on("outgoing::open",(function(){var e=t.readyState;t.readyState=m.OPENING,e!==t.readyState&&t.emit("readyStateChange","opening")})),t.on("incoming::open",(function(){var e=t.readyState;if(t.recovery.reconnecting()&&t.recovery.reconnected(),t.writable=!0,t.readable=!0,t.online||(t.online=!0,t.emit("online")),t.readyState=m.OPEN,e!==t.readyState&&t.emit("readyStateChange","open"),t.heartbeat(),t.buffer.length){var n=t.buffer.slice(),r=n.length,o=0;for(t.buffer.length=0;o<r;o++)t._write(n[o])}t.emit("open")})),t.on("incoming::ping",(function(e){t.online=!0,t.heartbeat(),t.emit("outgoing::pong",e),t._write("primus::pong::"+e)})),t.on("incoming::error",(function(e){var n=t.timers.active("connect"),r=e;if("string"==typeof e)r=new Error(e);else if(!(e instanceof Error)&&"object"==typeof e)for(var o in r=new Error(e.message||e.reason),e)Object.prototype.hasOwnProperty.call(e,o)&&(r[o]=e[o]);if(t.recovery.reconnecting())return t.recovery.reconnected(r);t.listeners("error").length&&t.emit("error",r),n&&(~t.options.strategy.indexOf("timeout")?t.recovery.reconnect():t.end())})),t.on("incoming::data",(function(e){t.decoder(e,(function(n,r){if(n)return t.listeners("error").length&&t.emit("error",n);t.protocol(r)||t.transforms(t,t,"incoming",r,e)}))})),t.on("incoming::end",(function(){var e=t.readyState;return t.disconnect?(t.disconnect=!1,t.end()):(t.readyState=m.CLOSED,e!==t.readyState&&t.emit("readyStateChange","end"),t.timers.active("connect")&&t.end(),e!==m.OPEN?!!t.recovery.reconnecting()&&t.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),t.emit("close"),~t.options.strategy.indexOf("disconnect")?t.recovery.reconnect():(t.emit("outgoing::end"),void t.emit("end"))))})),t.client(),t.ark)t.ark[n].call(t,t,e);return t.NETWORK_EVENTS?(t.offlineHandler=function(){t.online&&(t.online=!1,t.emit("offline"),t.end(),t.recovery.reset())},t.onlineHandler=function(){t.online||(t.online=!0,t.emit("online"),~t.options.strategy.indexOf("online")&&t.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",t.offlineHandler,!1),window.addEventListener("online",t.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",t.offlineHandler),document.body.attachEvent("ononline",t.onlineHandler)),t):t},m.prototype.protocol=function(e){if("string"!=typeof e||0!==e.indexOf("primus::"))return!1;var t=e.indexOf(":",8),n=e.slice(t+2);switch(e.slice(8,t)){case"ping":this.emit("incoming::ping",+n);break;case"server":"close"===n&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",n);break;default:return!1}return!0},m.prototype.transforms=function(e,t,n,r,o){var i={data:r},s=e.transformers[n];return function e(n,r){var o=s[n++];if(!o)return r();if(1===o.length){if(!1===o.call(t,i))return;return e(n,r)}o.call(t,i,(function(o,i){if(o)return t.emit("error",o);!1!==i&&e(n,r)}))}(0,(function(){if("incoming"===n)return t.emit("data",i.data,o);t._write(i.data)})),this},m.prototype.id=function(e){return this.socket&&this.socket.id?e(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",e))},m.prototype.open=function(){return h(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},m.prototype.write=function(e){return h(this,"write"),this.transforms(this,this,"outgoing",e),!0},m.prototype._write=function(e){var t=this;return m.OPEN!==t.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(e),!1):(t.encoder(e,(function(e,n){if(e)return t.listeners("error").length&&t.emit("error",e);"string"==typeof n&&(~n.indexOf("\u2028")&&(n=n.replace(l,"\\u2028")),~n.indexOf("\u2029")&&(n=n.replace(p,"\\u2029"))),t.emit("outgoing::data",n)})),!0)},m.prototype.heartbeat=function(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",(function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))}),this.options.pingTimeout),this):this},m.prototype.timeout=function(){var e=this;function t(){e.removeListener("error",t).removeListener("open",t).removeListener("end",t).timers.clear("connect")}return e.timers.setTimeout("connect",(function(){t(),e.readyState===m.OPEN||e.recovery.reconnecting()||(e.emit("timeout"),~e.options.strategy.indexOf("timeout")?e.recovery.reconnect():e.end())}),e.options.timeout),e.on("error",t).on("open",t).on("end",t)},m.prototype.end=function(e){if(h(this,"end"),this.readyState===m.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==e&&this.write(e),this.writable=!1,this.readable=!1;var t=this.readyState;return this.readyState=m.CLOSED,t!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},m.prototype.destroy=u("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),m.prototype.clone=function(e){return this.merge({},e)},m.prototype.merge=function(e){for(var t,n,r=1;r<arguments.length;r++)for(t in n=arguments[r])Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e},m.prototype.parse=e("url-parse"),m.prototype.querystring=c.parse,m.prototype.querystringify=c.stringify,m.prototype.uri=function(e){var t=this.url,n=[],r=!1;e.query&&(r=!0),(e=e||{}).protocol="protocol"in e?e.protocol:"http:",e.query=!(!t.query||!r)&&t.query.slice(1),e.secure="secure"in e?e.secure:"https:"===t.protocol||"wss:"===t.protocol,e.auth="auth"in e?e.auth:t.auth,e.pathname="pathname"in e?e.pathname:this.pathname,e.port="port"in e?+e.port:+t.port||(e.secure?443:80);var o=this.querystring(e.query||"");return o._primuscb=f(),e.query=this.querystringify(o),this.emit("outgoing::url",e),n.push(e.secure?e.protocol.replace(":","s:"):e.protocol,""),n.push(e.auth?e.auth+"@"+t.host:t.host),e.pathname&&n.push(e.pathname.slice(1)),r?n[n.length-1]+="?"+e.query:delete e.query,e.object?e:n.join("/")},m.prototype.transform=function(e,t){return h(this,"transform"),e in this.transformers?(this.transformers[e].push(t),this):this.critical(new Error("Invalid transformer type"))},m.prototype.critical=function(e){if(this.emit("error",e))return this;throw e},m.connect=function(e,t){return new m(e,t)},m.EventEmitter=o,m.prototype.client=function(){var e,t=this,n=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return m.requires("ws")}catch(e){}}();if(!n)return t.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));t.on("outgoing::open",(function(){t.emit("outgoing::end");try{var r={protocol:"ws+unix:"===t.url.protocol?"ws+unix:":"ws:",query:!0};3===n.length?("ws+unix:"===r.protocol&&(r.pathname="/"+t.url.hostname+t.url.pathname+":"+t.pathname),t.socket=e=new n(t.uri(r),[],t.transport)):(t.socket=e=new n(t.uri(r)),e.binaryType="arraybuffer")}catch(e){return t.emit("error",e)}e.onopen=t.emits("incoming::open"),e.onerror=t.emits("incoming::error"),e.onclose=t.emits("incoming::end"),e.onmessage=t.emits("incoming::data",(function(e,t){e(void 0,t.data)}))})),t.on("outgoing::data",(function(r){if(e&&e.readyState===n.OPEN)try{e.send(r)}catch(e){t.emit("incoming::error",e)}})),t.on("outgoing::reconnect",(function(){t.emit("outgoing::open")})),t.on("outgoing::end",(function(){e&&(e.onerror=e.onopen=e.onclose=e.onmessage=function(){},e.close(),e=null)}))},m.prototype.authorization=!1,m.prototype.pathname="/primus",m.prototype.encoder=function(e,t){var n;try{e=JSON.stringify(e)}catch(e){n=e}t(n,e)},m.prototype.decoder=function(e,t){var n;if("string"!=typeof e)return t(n,e);try{e=JSON.parse(e)}catch(e){n=e}t(n,e)},m.prototype.version="8.0.4","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",(function(e){27===e.keyCode&&e.preventDefault&&e.preventDefault()}),!1);var d=(navigator.userAgent||"").toLowerCase(),y=d.match(/.+(?:rv|it|ra|ie)[/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],v=+[y[1],y[2]].join(".");!~d.indexOf("chrome")&&~d.indexOf("safari")&&v<534.54&&(m.prototype.AVOID_WEBSOCKETS=!0)}t.exports=m},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:8,recovery:9,"tick-tock":12,"url-parse":14,yeast:15}]},{},[16])(16);return e}),[]);