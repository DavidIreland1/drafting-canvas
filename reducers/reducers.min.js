!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.reducer=n():t.reducer=n()}(global,(function(){return(()=>{"use strict";var t={d:(n,e)=>{for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},o:(t,n)=>Object.prototype.hasOwnProperty.call(t,n),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},n={};t.r(n),t.d(n,{default:()=>f});const e=function(){function t(){}return t.draw=function(t,n){},t.resize=function(t,n,e,r,o){},t.collide=function(t,n){return!1},t.outline=function(t,n,e,r){},t.highlight=function(t,n,e,r,o){var i=this;this.outline(t,n,e,r);var u=this.bound(t),a=this.center(t);n.translate(a.x,a.y),n.rotate(t.rotation),n.strokeStyle=e,n.lineWidth=r,n.beginPath(),n.rect(-u.width/2,-u.height/2,u.width,u.height),n.stroke(),u.width+u.height>4*o&&(u.x=-u.width/2,u.y=-u.height/2,this.boxes(t.id,u,o).forEach((function(t){i.drawSquare(t,n,e,r)}))),n.rotate(-t.rotation),n.translate(-a.x,-a.y)},t.center=function(t){var n=this.bound(t);return{x:n.x+n.width/2,y:n.y+n.height/2}},t.bound=function(t){return{x:t.x,y:t.y,width:t.width,height:t.height}},t.move=function(t,n,e){t.x+=n.x-e.x,t.y+=n.y-e.y},t.collideResize=function(t,n,e){var r=this,o=this.bound(t);return n=this.rotatePoint(n,this.center(t),-t.rotation),!!this.boxes(t.id,o,e).find((function(t){return r.collideBox(t,n)}))},t.rotatePoint=function(t,n,e){var r=Math.sin(e),o=Math.cos(e),i=t.x-n.x,u=t.y-n.y;return{x:i*o-u*r+n.x,y:u*o+i*r+n.y}},t.collideRotate=function(t,n,e){var r=this,o=this.bound(t);return o.x-=e,o.y-=e,o.width+=2*e,o.height+=2*e,n=this.rotatePoint(n,this.center(t),-t.rotation),!!this.boxes(t.id,o,2*e).find((function(t){return r.collideBox(t,n)}))},t.rotate=function(t,n){t.rotation+=n},t.collideBox=function(t,n){return t.x<n.x&&n.x<t.x+t.width&&t.y<n.y&&n.y<t.y+t.width},t.drawSquare=function(t,n,e,r){n.fillStyle="white",n.beginPath(),n.rect(t.x,t.y,t.width,t.height),n.fill(),n.strokeStyle=e,n.lineWidth=r,n.stroke()},t.boxes=function(t,n,e){return[{id:t,x:n.x-e,y:n.y-e,width:2*e,height:2*e},{id:t,x:n.x+n.width-e,y:n.y-e,width:2*e,height:2*e},{id:t,x:n.x-e,y:n.y+n.height-e,width:2*e,height:2*e},{id:t,x:n.x+n.width-e,y:n.y+n.height-e,width:2*e,height:2*e}]},t}();var r,o=(r=function(t,n){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=t}r(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)});const i=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return o(n,t),n.draw=function(t,n){n.fillStyle=t.color,n.beginPath(),n.arc(t.x,t.y,t.radius,t.start_angle,t.end_angle,t.counter_clockwise),n.fill()},n.outline=function(t,n,e,r){n.strokeStyle=e,n.lineWidth=r,n.beginPath(),n.arc(t.x,t.y,t.radius,t.start_angle,t.end_angle),n.stroke()},n.collide=function(t,n){return Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)<Math.pow(t.radius,2)},n.bound=function(t){return{x:t.x-t.radius,y:t.y-t.radius,width:2*t.radius,height:2*t.radius}},n.resize=function(t,n,e){var r=((n.x-e.x)/2+(n.y-e.y)/2)/2;t.x+=r,t.y+=r;var o=Math.sign(e.x+r-t.x);Math.sign(e.y+r-t.y),t.radius+=o*r,t.radius=Math.abs(t.radius)},n}(e);var u=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const a=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return u(n,t),n.draw=function(t,n){n.fillStyle=t.color,n.beginPath(),n.ellipse(t.x,t.y,t.radius_x,t.radius_y,t.rotation,t.start_angle,t.end_angle,t.counter_clockwise),n.fill()},n.outline=function(t,n,e,r){n.strokeStyle=e,n.lineWidth=r,n.beginPath(),n.ellipse(t.x,t.y,t.radius_x,t.radius_y,t.rotation,t.start_angle,t.end_angle,t.counter_clockwise),n.stroke()},n.collide=function(t,n){return n=this.rotatePoint(n,this.center(t),-t.rotation),Math.pow(t.x-n.x,2)/Math.pow(t.radius_x,2)+Math.pow(t.y-n.y,2)/Math.pow(t.radius_y,2)<1},n.center=function(t){return{x:t.x,y:t.y}},n.bound=function(t){return{x:t.x-t.radius_x,y:t.y-t.radius_y,width:2*t.radius_x,height:2*t.radius_y}},n.resize=function(t,n,e,r,o){var i=(n.x-e.x)/2,u=(n.y-e.y)/2;i*=Math.sin(t.rotation+Math.PI/4),u*=Math.cos(t.rotation+Math.PI/4),t.x+=i,t.y+=u,t.radius_x+=r*i,t.radius_y+=o*u,t.radius_x=Math.abs(t.radius_x),t.radius_y=Math.abs(t.radius_y)},n}(e);var c=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const s=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return c(n,t),n.draw=function(t,n){var e=this.center(t);n.translate(e.x,e.y),n.rotate(t.rotation),n.translate(-e.x,-e.y),t.elements.forEach((function(t){return h[t.type].draw(t,n)})),n.translate(e.x,e.y),n.rotate(-t.rotation),n.translate(-e.x,-e.y)},n.bound=function(t){var n=t.elements.map((function(t){return h[t.type].bound(t)})),e=n.reduce((function(t,n){return Math.min(t,n.x)}),Number.MAX_SAFE_INTEGER),r=n.reduce((function(t,n){return Math.min(t,n.y)}),Number.MAX_SAFE_INTEGER);return{x:e,y:r,width:n.reduce((function(t,n){return Math.max(t,n.x+n.width)}),Number.MIN_SAFE_INTEGER)-e,height:n.reduce((function(t,n){return Math.max(t,n.y+n.height)}),Number.MIN_SAFE_INTEGER)-r}},n.move=function(t,n,e){t.elements.forEach((function(t){h[t.type].move(t,n,e)}))},n.collide=function(t,n){return!!t.elements.find((function(t){return h[t.type].collide(t,n)}))},n.resize=function(t,n,e,r,o){t.elements.forEach((function(t){h[t.type].resize(t,n,e,r,o)}))},n}(e);var l=function(){var t=function(n,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])})(n,e)};return function(n,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}t(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();const h={circle:i,ellipse:a,group:s,rectangle:function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return l(n,t),n.draw=function(t,n){n.fillStyle=t.color;var e=this.center(t);n.translate(e.x,e.y),n.rotate(t.rotation),n.beginPath(),n.rect(-t.width/2,-t.height/2,t.width,t.height),n.fill(),n.rotate(-t.rotation),n.translate(-e.x,-e.y)},n.outline=function(t,n,e,r){n.strokeStyle=e,n.lineWidth=r;var o=this.center(t);n.translate(o.x,o.y),n.rotate(t.rotation),n.beginPath(),n.rect(-t.width/2,-t.height/2,t.width,t.height),n.stroke(),n.rotate(-t.rotation),n.translate(-o.x,-o.y)},n.collide=function(t,n){return n=this.rotatePoint(n,this.center(t),-t.rotation),t.x<n.x&&n.x<t.x+t.width&&t.y<n.y&&n.y<t.y+t.height},n.bound=function(t){return{x:t.x,y:t.y,width:t.width,height:t.height}},n.resize=function(t,n,e,r,o){var i=(n.x-e.x)/2,u=(n.y-e.y)/2;t.x+=i/2,t.y+=u/2,t.width+=r*i,t.height+=o*u,t.width=Math.abs(t.width),t.height=Math.abs(t.height)},n}(e)},f={overwrite:function(t,n){t.cursors=n.payload.state.cursors,t.views=n.payload.state.views,t.elements=n.payload.state.elements},view:function(t,n){var e=n.payload,r=e.id,o=e.delta_x,i=e.delta_y,u=e.delta_scale,a=t.views.find((function(t){return r===t.id}));o&&(a.x+=o),i&&(a.y+=i),u&&(a.scale+=u)},cursor:function(t,n){var e=n.payload,r=e.id,o=e.x,i=e.y,u=e.rotation,a=e.type,c=t.cursors.find((function(t){return r===t.id}));o&&(c.x=o),i&&(c.y=i),u&&(c.rotation=u),a&&(c.type=a)},move:function(t,n){var e=n.payload,r=e.position,o=e.last_position;t.elements.filter((function(t){return t.selected})).forEach((function(t){return h[t.type].move(t,r,o)}))},select:function(t,n){var e=t.elements.find((function(t){return t.id===n.payload.id}));e&&(e.selected=!0)},unselect:function(t,n){var e=t.elements.find((function(t){return t.id===n.payload.id}));e&&(e.selected=!1)},selectAll:function(t){t.elements.forEach((function(t){return t.selected=!0}))},unselectAll:function(t){t.elements.forEach((function(t){return t.selected=!1}))},hover:function(t,n){t.elements.find((function(t){return t.id===n.payload.id})).hover=!0},unhover:function(t,n){t.elements.find((function(t){return t.id===n.payload.id})).hover=!1},resize:function(t,n){var e=n.payload,r=e.id,o=e.position,i=e.last_position,u=t.elements.filter((function(t){return t.selected})),a=t.elements.find((function(t){return r===t.id})),c=h[a.type].center(a),s=Math.sign(i.x-c.x),l=Math.sign(i.y-c.y);u.forEach((function(t){return h[t.type].resize(t,o,i,s,l)}))},rotate:function(t,n){var e=n.payload,r=e.id,o=e.position,i=e.last_position,u=t.elements.filter((function(t){return t.selected})),a=t.elements.find((function(t){return r===t.id})),c=h[a.type].center(a),s=Math.atan2(c.y-o.y,c.x-o.x)-Math.atan2(c.y-i.y,c.x-i.x);u.forEach((function(t){return h[t.type].rotate(t,s)})),t.cursors.find((function(t){return r===t.id})).rotation+=s}};return n})()}));